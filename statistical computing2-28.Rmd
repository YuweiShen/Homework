---
title: "Butler抽样法近似复合抽样公式推导"
author: "沈雨薇 2016200620"
date: "2019年2月28日"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
---

# 问题描述
Butler抽样法是复合抽样法和近似抽样法的结合，需要先把密度函数分解成几段，对于每段密度函数，都用简单的线性函数来近似，我们需要证明分解式。

# 证明过程 

## 1.计算近似直线的函数表达式
首先在每段密度函数小区间$(x_{i-1},x_i]$用直线作为曲线$f_i(x)$的近似。已知该区间上两个端点的坐标分别为
$$(x_{i-1},f_i(x_{i-1})) ,(x_i,f_i(x_i))$$
则可以用直线
$$y=\frac{f_i(x_i)-f_{i-1}(x_{i-1})}{x_i-x_{i-1}}(x-x_{i-1})+f_{i-1}(x_{i-1})=\frac{m(f(x_i)-f(x_{i-1}))}{x_i-x_{i-1}}(x-x_{i-1})+mf(x_{i-1}),x\in (x_{i-1},x_i]$$
来近似$f_i(x),x\in (x_{i-1},x_i]$

## 2.对直线进行标准化处理
由于直线需要写成密度函数的分解，因此在区间$(x_{i-1},x_i]$上，需要满足该近似函数的积分值为1，即直线下梯形的面积为1,假设标准化系数为$\alpha$,则
$$S_{梯}=\frac{\int_{x_{i-1}}^{x_i}ydx}{\alpha}=\frac{m(f(x_i)+f(x_{i-1}))(x_i-x_{i-1})}{2\alpha}=1 $$
因此，可以将直线标准化成
$$y\prime=\frac{y}{\alpha}=\frac{2(f(x_i)-f(x_{i-1}))}{(x_i-x_{i-1})^2(f(x_i)+f(x_{i-1}))}(x-x_{i-1})+\frac{2f(x_{i-1})}{(f(x_i)+f(x_{i-1}))(x_i-x_{i-1})},x\in (x_{i-1},x_i]$$

## 3.用复合抽样法将函数表达式分解成两部分
将梯形分割成三角形和长方形两部分，可以分成两种情况来讨论。长方形对应的是均匀分布。

### (1)
当$f(x_i)>f(x_{i-1})$时，直线$y\prime$的斜率大于0.由复合抽样法，可以将$y\prime$写成
$$y\prime=d_1f_{i1}+(1-d_1)f_{i2}$$
不妨令$f_{i2}$为均匀分布的密度函数，则有$f_{i2}=\frac{1}{x_i-x_{i-1}},x\in (x_{i-1},x_i]$\\
故有$$1-d_1=\frac{2f(x_{i-1})}{f(x_i)+f(x_{i-1})}$$
解得$$d_1=\frac{f(x_i)-f(x_{i-1})}{f(x_i)+f(x_{i-1})}$$
故有$d_1f_{i1}=\frac{2(f(x_i)-f(x_{i-1}))}{(x_i-x_{i-1})^2(f(x_i)+f(x_{i-1}))}(x-x_{i-1})$\\
$$f_{i1}=\frac{2}{(x_i-x_{i-1})^2}(x-x_{i-1})$$

### (2)
当$f(x_i)\le f(x_{i-1})$时，直线$y\prime$的斜率小于等于0.\\
此时，由于$x_i和x_{i-1}$的对称性，可以将直线$y\prime$改写成$$y\prime=\frac{2(f(x_i)-f(x_{i-1}))}{(x_i-x_{i-1})^2(f(x_i)+f(x_{i-1}))}(x-x_i)+\frac{2f(x_i)}{(f(x_i)+f(x_{i-1}))(x_i-x_{i-1})},x\in (x_{i-1},x_i]$$
与情况(1)相同，不妨假设$f_{i2}$为均匀分布的密度函数，
则有故有$$1-d_2=\frac{2f(x_i)}{f(x_i)+f(x_{i-1})}$$
解得$$d_2=\frac{-f(x_i)+f(x_{i-1})}{f(x_i)+f(x_{i-1})}=-d_1$$
故有$d_2f_{i1}=\frac{2(f(x_i)-f(x_{i-1}))}{(x_i-x_{i-1})^2(f(x_i)+f(x_{i-1}))}(x-x_i)$\\
$$f_{i1}=-\frac{2}{(x_i-x_{i-1})^2}(x-x_i)$$

# 结果整理
综合上面两种情况，我们有
$$d=\frac{|f(x_i)-f(x_{i-1})|}{x_i-x_{i-1}}$$
$$f_{i2}=\frac{1}{x_i-x_{i-1}},x\in (x_{i-1},x_i]$$
$$f_{i1}=
\left\{\begin{array}
\ \frac{2}{(x_i-x_{i-1})^2}(x-x_{i-1})& f(x_i)>f(x_{i-1}),\\
-\frac{2}{(x_i-x_{i-1})^2}(x-x_i)& f(x_i)\le f(x_{i-1}).
\end{array}\right.$$
又因为$$S_{\Delta}=\frac{1}{2}(x_i-x_{i-1})(|f(x_i)-f(x_{i-1})|),\\
故\frac{S_{\Delta}}{S_{梯}}=\frac{|f(x_i)-f(x_{i-1})|}{f(x_i)+f(x_{i-1})}=d$$
